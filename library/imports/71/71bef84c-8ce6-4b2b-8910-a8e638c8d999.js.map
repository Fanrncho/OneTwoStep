{"version":3,"sources":["../../../../../assets/game/script/assets/game/script/gameManager.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","blockInput","Game","GameManager","getComponent","BlockInputEvents","enabled","setTimeout","node","onLoad","game","addPersistRootNode","director","getCollisionManager","clientEvent","init","dataFunc","loadConfigs","view","enableAutoFullScreen","on","eventType","leaveRoomNotify","leaveRoom","gameOver","network","window","chooseNetworkMode","getRankDataListener","findPlayerByAccountListener","gamePanel","uiFunc","findUI","gameState","GameState","Over","Canvas","instance","designResolution","height","width","openUI","bind","data","None","leaveRoomInfo","userId","userInfo","id","result","dispatch","sendReadyMsg","msg","action","READY","sendEventEx","sendRoundStartMsg","ROUND_START","startGame","selfScore","rivalScore","readyCnt","loadScene","matchVsInit","response","initResponse","errorResponse","joinRoomResponse","joinRoomNotify","leaveRoomResponse","joinOverResponse","createRoomResponse","getRoomListResponse","getRoomDetailResponse","getRoomListExResponse","kickPlayerResponse","kickPlayerNotify","registerUserResponse","loginResponse","logoutResponse","sendEventNotify","networkStateNotify","engine","channel","platform","gameId","appKey","gameVersion","console","log","netNotify","owner","userID","isRoomOwner","state","isRivalLeave","leaveRoomMedNotify","kickPlayerRsp","status","rsp","roomInfos","joinOverRsp","roomUserInfoList","roomInfo","roomUserInfo","leaveRoomRsp","disconnect","removePersistRootNode","error","obj","uiTip","setData","logout","registerUser","deviceId","gatewayId","login","token","info","lobbyShow","cpProto","JSON","parse","indexOf","GAME_START_EVENT","playerUserIds","remoteUserIds","userIds","forEach","push","PLAYER_STEP_DATA","srcUserId","PlayerManager","rival","jumpPos","player","length","PLAYER_SPEED_UP_EVENT","speedUpNotify","GAME_OVER_EVENT","playerId","Play","roundStart","RoadManager","initRoad","ROAD_DATA","spawnStoneNotify","stringify","sendEvent","recvMsg","uiRankPanel","rankArray","playerAccountGet","loginServer","isConnected","connect","IP","PORT","send","nickName","avatarUrl","userInfoReq","onDestroy","off"],"mappings":"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","file":"gameManager.js","sourceRoot":"../../../../../assets/game/script","sourcesContent":["var mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\n\ncc.Class({\n    extends: cc.Component,\n\n    blockInput() {\n        Game.GameManager.getComponent(cc.BlockInputEvents).enabled = true;\n        setTimeout(function() {\n            Game.GameManager.node.getComponent(cc.BlockInputEvents).enabled = false;\n        }, 1000);\n    },\n\n    onLoad() {\n        Game.GameManager = this;\n        cc.game.addPersistRootNode(this.node);\n        cc.director.getCollisionManager().enabled = true;\n        clientEvent.init();\n        dataFunc.loadConfigs();\n        cc.view.enableAutoFullScreen(false);\n        clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\n        clientEvent.on(clientEvent.eventType.gameOver, this.gameOver, this);\n        this.network = window.network;\n        this.network.chooseNetworkMode();\n        this.getRankDataListener();\n        this.findPlayerByAccountListener();\n\n        // if (window.wx) {\n        //     wx.login({\n        //         success: function() {\n        //             wx.getUserInfo({\n        //                 fail: function(res) {\n        //                     // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n        //                     if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\n        //                         // 处理用户拒绝授权的情况\n        //                         console.log(\"fail\");\n        //                     }\n        //                 },\n        //                 success: function(res) {\n        //                     Game.GameManager.nickName = res.userInfo.nickName;\n        //                     Game.GameManager.avatarUrl = res.userInfo.avatarUrl;\n        //                     console.log('success', Game.GameManager.nickName);\n        //                 }\n        //             });\n        //         }\n        //     })\n        // }\n    },\n\n    gameOver: function() {\n        // 打开结算界面--\n        var gamePanel = uiFunc.findUI(\"uiGamePanel\");\n        if (gamePanel && Game.GameManager.gameState !== GameState.Over) {\n            Game.GameManager.gameState = GameState.Over;\n            setTimeout(function() {\n                if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n                    uiFunc.openUI(\"uiVsResultVer\");\n                } else {\n                    uiFunc.openUI(\"uiVsResult\");\n                }\n            }.bind(this), 1000);\n        }\n    },\n\n    leaveRoom: function(data) {\n        // 离开房间--\n        if (this.gameState !== GameState.None) {\n            if (data.leaveRoomInfo.userId !== GLB.userInfo.id) {\n                Game.GameManager.result = true;\n                clientEvent.dispatch(clientEvent.eventType.gameOver);\n            } else {\n                clientEvent.dispatch(clientEvent.eventType.gameOver);\n            }\n        }\n    },\n\n    sendReadyMsg: function() {\n        var msg = {action: GLB.READY};\n        this.sendEventEx(msg);\n    },\n\n    sendRoundStartMsg: function() {\n        var msg = {action: GLB.ROUND_START};\n        this.sendEventEx(msg);\n    },\n\n    startGame: function() {\n        this.selfScore = 0;\n        this.rivalScore = 0;\n        this.gameState = GameState.None;\n        this.readyCnt = 0;\n        cc.director.loadScene('game', function() {\n            uiFunc.openUI(\"uiGamePanel\", function() {\n                this.sendReadyMsg();\n            }.bind(this));\n        }.bind(this));\n    },\n\n\n    matchVsInit: function() {\n        mvs.response.initResponse = this.initResponse.bind(this);\n        mvs.response.errorResponse = this.errorResponse.bind(this);\n        mvs.response.joinRoomResponse = this.joinRoomResponse.bind(this);\n        mvs.response.joinRoomNotify = this.joinRoomNotify.bind(this);\n        mvs.response.leaveRoomResponse = this.leaveRoomResponse.bind(this);\n        mvs.response.leaveRoomNotify = this.leaveRoomNotify.bind(this);\n        mvs.response.joinOverResponse = this.joinOverResponse.bind(this);\n        mvs.response.createRoomResponse = this.createRoomResponse.bind(this);\n        mvs.response.getRoomListResponse = this.getRoomListResponse.bind(this);\n        mvs.response.getRoomDetailResponse = this.getRoomDetailResponse.bind(this);\n        mvs.response.getRoomListExResponse = this.getRoomListExResponse.bind(this);\n        mvs.response.kickPlayerResponse = this.kickPlayerResponse.bind(this);\n        mvs.response.kickPlayerNotify = this.kickPlayerNotify.bind(this);\n        mvs.response.registerUserResponse = this.registerUserResponse.bind(this);\n        mvs.response.loginResponse = this.loginResponse.bind(this); // 用户登录之后的回调\n        mvs.response.logoutResponse = this.logoutResponse.bind(this); // 用户登录之后的回调\n        mvs.response.sendEventNotify = this.sendEventNotify.bind(this);\n        mvs.response.networkStateNotify = this.networkStateNotify.bind(this);\n\n        // var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId);\n        var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId,\n            GLB.appKey, GLB.gameVersion);\n        if (result !== 0) {\n            console.log('初始化失败,错误码:' + result);\n        }\n        Game.GameManager.blockInput();\n    },\n\n    networkStateNotify: function(netNotify) {\n        console.log(\"netNotify\");\n        console.log(\"netNotify.owner:\" + netNotify.owner);\n        if (netNotify.userID !== GLB.userInfo.id) {\n            GLB.isRoomOwner = true;\n        }\n        console.log(\"玩家：\" + netNotify.userID + \" state:\" + netNotify.state);\n        if (netNotify.userID !== GLB.userInfo.id) {\n            this.isRivalLeave = true;\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify, netNotify);\n\n        clientEvent.dispatch(clientEvent.eventType.gameOver);\n    },\n\n    kickPlayerNotify: function(kickPlayerNotify) {\n        var data = {\n            kickPlayerNotify: kickPlayerNotify\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerNotify, data);\n    },\n\n    kickPlayerResponse: function(kickPlayerRsp) {\n        if (kickPlayerRsp.status !== 200) {\n            console.log(\"失败kickPlayerRsp:\" + kickPlayerRsp);\n            return;\n        }\n        var data = {\n            kickPlayerRsp: kickPlayerRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerResponse, data);\n    },\n\n    getRoomListExResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListExResponse, data);\n    },\n\n    getRoomDetailResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomDetailResponse, data);\n    },\n\n    getRoomListResponse: function(status, roomInfos) {\n        if (status !== 200) {\n            console.log(\"失败 status:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomInfos: roomInfos\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListResponse, data);\n    },\n\n    createRoomResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 createRoomResponse:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.createRoomResponse, data);\n    },\n\n    joinOverResponse: function(joinOverRsp) {\n        if (joinOverRsp.status !== 200) {\n            console.log(\"失败 joinOverRsp:\" + joinOverRsp);\n            return;\n        }\n        var data = {\n            joinOverRsp: joinOverRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinOverResponse, data);\n    },\n\n    joinRoomResponse: function(status, roomUserInfoList, roomInfo) {\n        if (status !== 200) {\n            console.log(\"失败 joinRoomResponse:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomUserInfoList: roomUserInfoList,\n            roomInfo: roomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomResponse, data);\n    },\n\n    joinRoomNotify: function(roomUserInfo) {\n        var data = {\n            roomUserInfo: roomUserInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomNotify, data);\n    },\n\n    leaveRoomResponse: function(leaveRoomRsp) {\n        if (leaveRoomRsp.status !== 200) {\n            console.log(\"失败 leaveRoomRsp:\" + leaveRoomRsp);\n            return;\n        }\n        var data = {\n            leaveRoomRsp: leaveRoomRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomResponse, data);\n    },\n\n    leaveRoomNotify: function(leaveRoomInfo) {\n        var data = {\n            leaveRoomInfo: leaveRoomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify);\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomNotify, data);\n    },\n\n    logoutResponse: function(status) {\n        Game.GameManager.network.disconnect();\n        cc.game.removePersistRootNode(this.node);\n        cc.director.loadScene('lobby');\n        console.log(\"reload lobby\");\n    },\n\n    errorResponse: function(error, msg) {\n        if (error === 1001 || error === 0) {\n            uiFunc.openUI(\"uiTip\", function(obj) {\n                var uiTip = obj.getComponent(\"uiTip\");\n                if (uiTip) {\n                    uiTip.setData(\"网络断开连接\");\n                }\n            });\n            setTimeout(function() {\n                mvs.engine.logout(\"\");\n                cc.game.removePersistRootNode(this.node);\n                cc.director.loadScene('lobby');\n            }.bind(this), 2500);\n        }\n        console.log(\"错误信息：\" + error);\n        console.log(\"错误信息：\" + msg);\n    },\n\n    initResponse: function() {\n        console.log('初始化成功，开始注册用户');\n        var result = mvs.engine.registerUser();\n        if (result !== 0) {\n            console.log('注册用户失败，错误码:' + result);\n        } else {\n            console.log('注册用户成功');\n        }\n    },\n\n    registerUserResponse: function(userInfo) {\n        var deviceId = 'abcdef';\n        var gatewayId = 0;\n        GLB.userInfo = userInfo;\n\n        console.log('开始登录,用户Id:' + userInfo.id)\n\n        /* var result = mvs.engine.login(\n            userInfo.id, userInfo.token,\n            GLB.gameId, GLB.gameVersion,\n            GLB.appKey, GLB.secret,\n            deviceId, gatewayId\n        ); */\n        var result = mvs.engine.login(userInfo.id, userInfo.token, deviceId);\n        if (result !== 0) {\n            console.log('登录失败,错误码:' + result);\n        }\n    },\n\n    loginResponse: function(info) {\n        if (info.status !== 200) {\n            console.log('登录失败,异步回调错误码:' + info.status);\n        } else {\n            console.log('登录成功');\n            this.lobbyShow();\n        }\n    },\n\n    lobbyShow: function() {\n        this.gameState = GameState.None;\n        if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n            uiFunc.openUI(\"uiLobbyPanelVer\");\n        } else {\n            uiFunc.openUI(\"uiLobbyPanel\");\n        }\n    },\n\n    // 玩家行为通知--\n    sendEventNotify: function(info) {\n        var cpProto = JSON.parse(info.cpProto);\n        if (info.cpProto.indexOf(GLB.GAME_START_EVENT) >= 0) {\n            GLB.playerUserIds = [GLB.userInfo.id]\n            var remoteUserIds = JSON.parse(info.cpProto).userIds;\n            remoteUserIds.forEach(function(id) {\n                if (GLB.userInfo.id !== id) {\n                    GLB.playerUserIds.push(id);\n                }\n            });\n            this.startGame();\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_STEP_DATA) >= 0) {\n            if (info.srcUserId !== GLB.userInfo.id) {\n                if (Game.PlayerManager.rival && Game.PlayerManager.rival.jumpPos) {\n                    Game.PlayerManager.rival.jumpPos.push(cpProto.data);\n                }\n            } else {\n                if (Game.PlayerManager.player && Game.PlayerManager.player.jumpPos) {\n                    Game.PlayerManager.player.jumpPos.push(cpProto.data);\n                }\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.READY) >= 0) {\n            this.readyCnt++;\n            if (GLB.isRoomOwner && this.readyCnt >= GLB.playerUserIds.length) {\n                this.sendRoundStartMsg();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_SPEED_UP_EVENT) >= 0) {\n            if (info.srcUserId !== GLB.userInfo.id) {\n                Game.PlayerManager.rival.speedUpNotify();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.GAME_OVER_EVENT) >= 0) {\n            if (Game.GameManager.gameState !== GameState.Over) {\n                if (cpProto.playerId === GLB.userInfo.id) {\n                    Game.GameManager.result = false;\n                    this.selfScore = cpProto.selfScore;\n                    this.rivalScore = cpProto.rivalScore;\n                } else {\n                    Game.GameManager.result = true;\n                    this.selfScore = cpProto.rivalScore;\n                    this.rivalScore = cpProto.selfScore;\n                }\n                clientEvent.dispatch(clientEvent.eventType.gameOver);\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.ROUND_START) >= 0) {\n            setTimeout(function() {\n                Game.GameManager.gameState = GameState.Play;\n            }.bind(this), 4000);\n            setTimeout(function() {\n                clientEvent.dispatch(clientEvent.eventType.roundStart);\n            }.bind(this), 3000);\n            Game.RoadManager.initRoad();\n        }\n\n        if (info.cpProto.indexOf(GLB.ROAD_DATA) >= 0) {\n            Game.RoadManager.spawnStoneNotify(cpProto.data);\n        }\n    },\n\n    sendEventEx: function(msg) {\n        var result = mvs.engine.sendEventEx(0, JSON.stringify(msg), 0, GLB.playerUserIds);\n        if (result.result !== 0) {\n            console.log(msg.action, result.result);\n        }\n    },\n\n    sendEvent: function(msg) {\n        var result = mvs.engine.sendEvent(JSON.stringify(msg));\n        if (result.result !== 0) {\n            console.log(msg.action, result.result);\n        }\n    },\n\n    getRankDataListener: function() {\n        this.network.on(\"connector.rankHandler.getRankData\", function(recvMsg) {\n            uiFunc.openUI(\"uiRankPanelVer\", function(obj) {\n                var uiRankPanel = obj.getComponent(\"uiRankPanel\");\n                uiRankPanel.setData(recvMsg.rankArray);\n            });\n        }.bind(this));\n    },\n\n    findPlayerByAccountListener: function() {\n        this.network.on(\"connector.entryHandler.findPlayerByAccount\", function(recvMsg) {\n            clientEvent.dispatch(clientEvent.eventType.playerAccountGet, recvMsg);\n        });\n    },\n\n    loginServer: function() {\n        if (!this.network.isConnected()) {\n            this.network.connect(GLB.IP, GLB.PORT, function() {\n                    this.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        this.network.send(\"connector.rankHandler.updateScore\", {\n                            \"account\": GLB.userInfo.id + \"\",\n                            \"game\": \"game2\"\n                        });\n                    }.bind(this), 500);\n                }.bind(this)\n            );\n        } else {\n            this.network.send(\"connector.rankHandler.updateScore\", {\n                \"account\": GLB.userInfo.id + \"\",\n                \"game\": \"game2\"\n            });\n        }\n    },\n\n    userInfoReq: function(userId) {\n        if (!Game.GameManager.network.isConnected()) {\n            Game.GameManager.network.connect(GLB.IP, GLB.PORT, function() {\n                    Game.GameManager.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                            \"account\": userId + \"\",\n                        });\n                    }, 200);\n                }\n            );\n        } else {\n            Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                \"account\": userId + \"\",\n            });\n        }\n    },\n\n    onDestroy() {\n        clientEvent.off(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\n        clientEvent.off(clientEvent.eventType.gameOver, this.gameOver, this);\n    }\n});\n"]}